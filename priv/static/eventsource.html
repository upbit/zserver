<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>EventSource</title>
<link rel="stylesheet" href="/static/css/normalize.css">

<script type="text/javascript">
function ready() {
	if (!!window.EventSource) {
		setupEventSource();
	} else {
		document.getElementById('status').innerHTML =
			"Sorry but your browser doesn't support the EventSource API";
	}
}
function setupEventSource() {
	var source = new EventSource('/eventsource');
	source.addEventListener('message', function(event) {
		addStatus("server sent the following: '" + event.data + "'");
		}, false);
		source.addEventListener('open', function(event) {
			addStatus('eventsource connected.')
		}, false);
		source.addEventListener('error', function(event) {
			if (event.eventPhase == EventSource.CLOSED) {
				addStatus('eventsource was closed.')
			}
		}, false);
}
function addStatus(text) {
	var date = new Date();
	document.getElementById('status').innerHTML
		= document.getElementById('status').innerHTML
		+ date + ": " + text + "<br/>";
	document.getElementById('status').scrollTop = 9e5;
}
</script>
</head>

<body onload="ready();">
	Hi!
	<div id="status"></div>
</body>
</html>
